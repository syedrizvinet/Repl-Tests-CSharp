<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net7.0</TargetFramework>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="ICSharpCode.Decompiler" Version="7.2.1.6856" />
    <PackageReference Include="Microsoft.CodeAnalysis.Analyzers" Version="3.3.3">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Scripting" Version="4.3.1" />
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Features" Version="4.3.1" />
    <PackageReference Include="Microsoft.CodeAnalysis.Workspaces.MSBuild" Version="4.3.1" />
    <PackageReference Include="Microsoft.Build.Locator" Version="1.5.5" />
    <PackageReference Include="Microsoft.Extensions.Caching.Memory" Version="7.0.0" />
    <PackageReference Include="Microsoft.Extensions.DependencyModel" Version="7.0.0" />
    <PackageReference Include="PrettyPrompt" Version="4.0.1" />
    <PackageReference Include="System.IO.Abstractions" Version="17.2.3" />
    <PackageReference Include="System.Configuration.ConfigurationManager" Version="7.0.0" />
    <!-- when updating NuGet.PackageManagement also update the RuntimeCopyLocalItems configuration below -->
    <PackageReference Include="NuGet.PackageManagement" Version="6.3.1" />
  </ItemGroup>

  <!--
    We shouldn't package the Nuget.* DLLs, but should instead have them loaded from the runtime sdk.
    https://github.com/microsoft/qsharp-compiler/issues/1470
    https://github.com/OmniSharp/omnisharp-roslyn/commit/efeafeca33abe1d19659ed8c7ebab1d7c3481188#diff-50e91c82311ea26f2a73202525dfdf2b0a89c178ee666b2bf3ad4c84ac4c06dc
  -->
  <Target AfterTargets="AfterResolveReferences" Name="SkipCopyOfHostDlls">
    <ItemGroup>
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.common\6.3.1\lib\netstandard2.0\NuGet.Common.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.configuration\6.3.1\lib\netstandard2.0\NuGet.Configuration.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.dependencyresolver.core\6.3.1\lib\net5.0\NuGet.DependencyResolver.Core.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.frameworks\6.3.1\lib\netstandard2.0\NuGet.Frameworks.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.librarymodel\6.3.1\lib\netstandard2.0\NuGet.LibraryModel.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.packaging.core\6.3.1\lib\net5.0\NuGet.Packaging.Core.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.packaging\6.3.1\lib\net5.0\NuGet.Packaging.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.projectmodel\6.3.1\lib\net5.0\NuGet.ProjectModel.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.protocol\6.3.1\lib\net5.0\NuGet.Protocol.dll" />
      <RuntimeCopyLocalItems Remove="$(NuGetPackageRoot)nuget.versioning\6.3.1\lib\netstandard2.0\NuGet.Versioning.dll" />
    </ItemGroup>
  </Target>

  <ItemGroup>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
    <_Parameter1>CSharpRepl.Tests</_Parameter1>
    </AssemblyAttribute>
  </ItemGroup>

  <ItemGroup>
    <Reference Include="Microsoft.FileFormats">
      <HintPath>lib\Microsoft.FileFormats.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.SymbolStore">
      <HintPath>lib\Microsoft.SymbolStore.dll</HintPath>
    </Reference>
  </ItemGroup>

  <ItemGroup>
    <None Update="runtime.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

</Project>
